!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/forms"),require("@angular/platform-browser"),require("lodash"),require("@ngsf/widget-library"),require("@ngsf/common"),require("@angular/common"),require("@ngsf/no-framework")):"function"==typeof define&&define.amd?define("@ngsf/json-schema-form",["exports","@angular/core","@angular/forms","@angular/platform-browser","lodash","@ngsf/widget-library","@ngsf/common","@angular/common","@ngsf/no-framework"],e):e(((t=t||self).ngsf=t.ngsf||{},t.ngsf["json-schema-form"]={}),t.ng.core,t.ng.forms,t.ng.platformBrowser,t.lodash,t.widgetLibrary,t.common,t.ng.common,t.noFramework)}(this,(function(t,e,s,i,o,r,a,n,h){"use strict";var f=this&&this.__decorate||function(t,e,s,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,s,i);else for(var n=t.length-1;n>=0;n--)(o=t[n])&&(a=(r<3?o(a):r>3?o(e,s,a):o(e,s))||a);return r>3&&a&&Object.defineProperty(e,s,a),a},m=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},u=this&&this.__read||function(t,e){var s="function"==typeof Symbol&&t[Symbol.iterator];if(!s)return t;var i,o,r=s.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(s=r.return)&&s.call(r)}finally{if(o)throw o.error}}return a},p=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,s=e&&t[e],i=0;if(s)return s.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},c=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(u(arguments[e]));return t},l={provide:s.NG_VALUE_ACCESSOR,useExisting:e.forwardRef((function(){return d})),multi:!0},d=function(){function t(t,s,i,o,r){this.changeDetector=t,this.frameworkLibrary=s,this.widgetLibrary=i,this.jsf=o,this.sanitizer=r,this.formValueSubscription=null,this.formInitialized=!1,this.objectWrap=!1,this.previousInputs={schema:null,layout:null,data:null,options:null,framework:null,widgets:null,form:null,model:null,JSONSchema:null,UISchema:null,formData:null,loadExternalAssets:null,debug:null},this.onChanges=new e.EventEmitter,this.onSubmit=new e.EventEmitter,this.isValid=new e.EventEmitter,this.validationErrors=new e.EventEmitter,this.formSchema=new e.EventEmitter,this.formLayout=new e.EventEmitter,this.dataChange=new e.EventEmitter,this.modelChange=new e.EventEmitter,this.formDataChange=new e.EventEmitter,this.ngModelChange=new e.EventEmitter}return Object.defineProperty(t.prototype,"value",{get:function(){return this.objectWrap?this.jsf.data[1]:this.jsf.data},set:function(t){this.setFormValues(t,!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stylesheets",{get:function(){var t=this.frameworkLibrary.getFrameworkStylesheets(),e=this.sanitizer.bypassSecurityTrustResourceUrl;return t.map((function(t){return e(t)}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scripts",{get:function(){var t=this.frameworkLibrary.getFrameworkScripts(),e=this.sanitizer.bypassSecurityTrustResourceUrl;return t.map((function(t){return e(t)}))},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){this.updateForm()},t.prototype.ngOnChanges=function(){this.updateForm()},t.prototype.writeValue=function(t){this.setFormValues(t,!1),this.formValuesInput||(this.formValuesInput="ngModel")},t.prototype.registerOnChange=function(t){this.onChange=t},t.prototype.registerOnTouched=function(t){this.onTouched=t},t.prototype.setDisabledState=function(t){this.jsf.formOptions.formDisabled!==!!t&&(this.jsf.formOptions.formDisabled=!!t,this.initializeForm())},t.prototype.updateForm=function(){var t=this;if(!this.formInitialized||!this.formValuesInput||this.language&&this.language!==this.jsf.language)this.initializeForm();else{this.language&&this.language!==this.jsf.language&&this.jsf.setLanguage(this.language);var e=Object.keys(this.previousInputs).filter((function(e){return t.previousInputs[e]!==t[e]})),s=!0;if(1===e.length&&"form"===e[0]&&this.formValuesInput.startsWith("form.")&&(e=Object.keys(this.previousInputs.form||{}).filter((function(e){return!o.isEqual(t.previousInputs.form[e],t.form[e])})).map((function(t){return"form."+t})),s=!1),1===e.length&&e[0]===this.formValuesInput)if(-1===this.formValuesInput.indexOf("."))this.setFormValues(this[this.formValuesInput],s);else{var i=u(this.formValuesInput.split("."),2),r=i[0],a=i[1];this.setFormValues(this[r][a],s)}else e.length&&(this.initializeForm(),this.onChange&&this.onChange(this.jsf.formValues),this.onTouched&&this.onTouched(this.jsf.formValues));Object.keys(this.previousInputs).filter((function(e){return t.previousInputs[e]!==t[e]})).forEach((function(e){return t.previousInputs[e]=t[e]}))}},t.prototype.setFormValues=function(t,e){if(void 0===e&&(e=!0),t){var s=this.objectWrap?t[1]:t;this.jsf.formGroup?e&&this.jsf.formGroup.reset():(this.jsf.formValues=t,this.activateForm()),this.jsf.formGroup&&this.jsf.formGroup.patchValue(s),this.onChange&&this.onChange(s),this.onTouched&&this.onTouched(s)}else this.jsf.formGroup.reset()},t.prototype.submitForm=function(){var t=this.jsf.validData;this.onSubmit.emit(this.objectWrap?t[1]:t)},t.prototype.initializeForm=function(){if(this.schema||this.layout||this.data||this.form||this.model||this.JSONSchema||this.UISchema||this.formData||this.ngModel||this.jsf.data){if(this.jsf.resetAllValues(),this.initializeOptions(),this.initializeSchema(),this.initializeLayout(),this.initializeData(),this.activateForm(),this.debug||this.jsf.formOptions.debug){this.debugOutput=[].map((function(t){return JSON.stringify(t,null,2)})).join("\n")}this.formInitialized=!0}},t.prototype.initializeOptions=function(){var t,e;this.language&&this.language!==this.jsf.language&&this.jsf.setLanguage(this.language),this.jsf.setOptions({debug:!!this.debug});var s=this.loadExternalAssets||!1,i=this.framework||"default";if(a.isObject(this.options)&&(this.jsf.setOptions(this.options),s=this.options.loadExternalAssets||s,i=this.options.framework||i),a.isObject(this.form)&&a.isObject(this.form.options)&&(this.jsf.setOptions(this.form.options),s=this.form.options.loadExternalAssets||s,i=this.form.options.framework||i),a.isObject(this.widgets)&&this.jsf.setOptions({widgets:this.widgets}),this.frameworkLibrary.setLoadExternalAssets(s),this.frameworkLibrary.setFramework(i),this.jsf.framework=this.frameworkLibrary.getFramework(),a.isObject(this.jsf.formOptions.widgets))try{for(var o=p(Object.keys(this.jsf.formOptions.widgets)),r=o.next();!r.done;r=o.next()){var n=r.value;this.widgetLibrary.registerWidget(n,this.jsf.formOptions.widgets[n])}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}a.isObject(this.form)&&a.isObject(this.form.tpldata)&&this.jsf.setTpldata(this.form.tpldata)},t.prototype.initializeSchema=function(){a.isObject(this.schema)?(this.jsf.AngularSchemaFormCompatibility=!0,this.jsf.schema=o.cloneDeep(this.schema)):a.hasOwn(this.form,"schema")&&a.isObject(this.form.schema)?this.jsf.schema=o.cloneDeep(this.form.schema):a.isObject(this.JSONSchema)?(this.jsf.ReactJsonSchemaFormCompatibility=!0,this.jsf.schema=o.cloneDeep(this.JSONSchema)):a.hasOwn(this.form,"JSONSchema")&&a.isObject(this.form.JSONSchema)?(this.jsf.ReactJsonSchemaFormCompatibility=!0,this.jsf.schema=o.cloneDeep(this.form.JSONSchema)):a.hasOwn(this.form,"properties")&&a.isObject(this.form.properties)?this.jsf.schema=o.cloneDeep(this.form):a.isObject(this.form),a.isEmpty(this.jsf.schema)||(a.inArray("object",this.jsf.schema.type)&&(this.jsf.schema.type="object"),a.hasOwn(this.jsf.schema,"type")&&"object"!==this.jsf.schema.type?(this.jsf.schema={type:"object",properties:{1:this.jsf.schema}},this.objectWrap=!0):a.hasOwn(this.jsf.schema,"type")||(a.isObject(this.jsf.schema.properties)||a.isObject(this.jsf.schema.patternProperties)||a.isObject(this.jsf.schema.additionalProperties)?this.jsf.schema.type="object":(this.jsf.JsonFormCompatibility=!0,this.jsf.schema={type:"object",properties:this.jsf.schema})),this.jsf.schema=a.convertSchemaToDraft6(this.jsf.schema),this.jsf.compileAjvSchema(),this.jsf.schema=a.resolveSchemaReferences(this.jsf.schema,this.jsf.schemaRefLibrary,this.jsf.schemaRecursiveRefMap,this.jsf.dataRecursiveRefMap,this.jsf.arrayMap),a.hasOwn(this.jsf.schemaRefLibrary,"")&&(this.jsf.hasRootReference=!0))},t.prototype.initializeData=function(){a.hasValue(this.data)?(this.jsf.formValues=o.cloneDeep(this.data),this.formValuesInput="data"):a.hasValue(this.model)?(this.jsf.AngularSchemaFormCompatibility=!0,this.jsf.formValues=o.cloneDeep(this.model),this.formValuesInput="model"):a.hasValue(this.ngModel)?(this.jsf.AngularSchemaFormCompatibility=!0,this.jsf.formValues=o.cloneDeep(this.ngModel),this.formValuesInput="ngModel"):a.isObject(this.form)&&a.hasValue(this.form.value)?(this.jsf.JsonFormCompatibility=!0,this.jsf.formValues=o.cloneDeep(this.form.value),this.formValuesInput="form.value"):a.isObject(this.form)&&a.hasValue(this.form.data)?(this.jsf.formValues=o.cloneDeep(this.form.data),this.formValuesInput="form.data"):a.hasValue(this.formData)?(this.jsf.ReactJsonSchemaFormCompatibility=!0,this.formValuesInput="formData"):a.hasOwn(this.form,"formData")&&a.hasValue(this.form.formData)?(this.jsf.ReactJsonSchemaFormCompatibility=!0,this.jsf.formValues=o.cloneDeep(this.form.formData),this.formValuesInput="form.formData"):this.formValuesInput=null},t.prototype.initializeLayout=function(){var t=this,e=function(t){return(a.isObject(t)||a.isArray(t))&&a.forEach(t,(function(t,e){a.hasOwn(t,"options")&&a.isObject(t.options)&&(t.titleMap=t.options,delete t.options)}),"top-down"),t};a.isArray(this.layout)?this.jsf.layout=o.cloneDeep(this.layout):a.isArray(this.form)?(this.jsf.AngularSchemaFormCompatibility=!0,this.jsf.layout=o.cloneDeep(this.form)):this.form&&a.isArray(this.form.form)?(this.jsf.JsonFormCompatibility=!0,this.jsf.layout=e(o.cloneDeep(this.form.form))):this.form&&a.isArray(this.form.layout)?this.jsf.layout=o.cloneDeep(this.form.layout):this.jsf.layout=["*"];var s=null;a.isObject(this.UISchema)?(this.jsf.ReactJsonSchemaFormCompatibility=!0,s=o.cloneDeep(this.UISchema)):a.hasOwn(this.form,"UISchema")?(this.jsf.ReactJsonSchemaFormCompatibility=!0,s=o.cloneDeep(this.form.UISchema)):a.hasOwn(this.form,"uiSchema")?(this.jsf.ReactJsonSchemaFormCompatibility=!0,s=o.cloneDeep(this.form.uiSchema)):a.hasOwn(this.form,"customFormItems")&&(this.jsf.JsonFormCompatibility=!0,s=e(o.cloneDeep(this.form.customFormItems))),s&&a.JsonPointer.forEachDeep(s,(function(e,s){var i=s.replace(/\//g,"/properties/").replace(/\/properties\/items\/properties\//g,"/items/properties/").replace(/\/properties\/titleMap\/properties\//g,"/titleMap/properties/");if(a.hasValue(e)&&a.hasValue(s)){var o=a.JsonPointer.toKey(s),r=(a.JsonPointer.parse(i)||[]).slice(0,-2),n=void 0;"ui:order"===o.toLowerCase()?n=c(r,["ui:order"]):("ui:"===o.slice(0,3).toLowerCase()&&(o=o.slice(3)),n=c(r,["x-schema-form",o])),a.JsonPointer.has(t.jsf.schema,r)&&!a.JsonPointer.has(t.jsf.schema,n)&&a.JsonPointer.set(t.jsf.schema,n,e)}}))},t.prototype.activateForm=function(){var t=this;if(a.isEmpty(this.jsf.schema)&&(a.isEmpty(this.jsf.formValues)||this.jsf.buildSchemaFromData()),a.isEmpty(this.jsf.schema)||(this.jsf.compileAjvSchema(),this.jsf.buildLayout(this.widgetLibrary),this.jsf.buildFormGroupTemplate(this.jsf.formValues),this.jsf.buildFormGroup()),this.jsf.formGroup){a.isEmpty(this.jsf.formValues)||!0===this.jsf.formOptions.setSchemaDefaults||!0===this.jsf.formOptions.setLayoutDefaults||this.setFormValues(this.jsf.formValues),this.jsf.dataChanges.subscribe((function(e){t.onChanges.emit(t.objectWrap?e[1]:e),t.formValuesInput&&-1===t.formValuesInput.indexOf(".")&&t[t.formValuesInput+"Change"].emit(t.objectWrap?e[1]:e)})),this.jsf.formGroup.statusChanges.subscribe((function(){return t.changeDetector.markForCheck()})),this.jsf.isValidChanges.subscribe((function(e){return t.isValid.emit(e)})),this.jsf.validationErrorChanges.subscribe((function(e){return t.validationErrors.emit(e)})),this.formSchema.emit(this.jsf.schema),this.formLayout.emit(this.jsf.layout),this.onChanges.emit(this.objectWrap?this.jsf.data[1]:this.jsf.data);var e=a.JsonPointer.get(this.jsf,"/formOptions/validateOnRender");if(e){var s=function(t){(!0===e||a.hasValue(t.value))&&t.markAsTouched(),Object.keys(t.controls||{}).forEach((function(e){return s(t.controls[e])}))};s(this.jsf.formGroup),this.isValid.emit(this.jsf.isValid),this.validationErrors.emit(this.jsf.ajvErrors)}}},t.ctorParameters=function(){return[{type:e.ChangeDetectorRef},{type:r.FrameworkLibraryService},{type:r.WidgetLibraryService},{type:r.JsonSchemaFormService},{type:i.DomSanitizer}]},f([e.Input(),m("design:type",Object)],t.prototype,"schema",void 0),f([e.Input(),m("design:type",Array)],t.prototype,"layout",void 0),f([e.Input(),m("design:type",Object)],t.prototype,"data",void 0),f([e.Input(),m("design:type",Object)],t.prototype,"options",void 0),f([e.Input(),m("design:type",Object)],t.prototype,"framework",void 0),f([e.Input(),m("design:type",Object)],t.prototype,"widgets",void 0),f([e.Input(),m("design:type",Object)],t.prototype,"form",void 0),f([e.Input(),m("design:type",Object)],t.prototype,"model",void 0),f([e.Input(),m("design:type",Object)],t.prototype,"JSONSchema",void 0),f([e.Input(),m("design:type",Object)],t.prototype,"UISchema",void 0),f([e.Input(),m("design:type",Object)],t.prototype,"formData",void 0),f([e.Input(),m("design:type",Object)],t.prototype,"ngModel",void 0),f([e.Input(),m("design:type",String)],t.prototype,"language",void 0),f([e.Input(),m("design:type",Boolean)],t.prototype,"loadExternalAssets",void 0),f([e.Input(),m("design:type",Boolean)],t.prototype,"debug",void 0),f([e.Output(),m("design:type",Object)],t.prototype,"onChanges",void 0),f([e.Output(),m("design:type",Object)],t.prototype,"onSubmit",void 0),f([e.Output(),m("design:type",Object)],t.prototype,"isValid",void 0),f([e.Output(),m("design:type",Object)],t.prototype,"validationErrors",void 0),f([e.Output(),m("design:type",Object)],t.prototype,"formSchema",void 0),f([e.Output(),m("design:type",Object)],t.prototype,"formLayout",void 0),f([e.Output(),m("design:type",Object)],t.prototype,"dataChange",void 0),f([e.Output(),m("design:type",Object)],t.prototype,"modelChange",void 0),f([e.Output(),m("design:type",Object)],t.prototype,"formDataChange",void 0),f([e.Output(),m("design:type",Object)],t.prototype,"ngModelChange",void 0),f([e.Input(),m("design:type",Object),m("design:paramtypes",[Object])],t.prototype,"value",null),t=f([e.Component({selector:"json-schema-form",template:'\n    <div *ngFor="let stylesheet of stylesheets">\n      <link rel="stylesheet" [href]="stylesheet" />\n    </div>\n    <div *ngFor="let script of scripts">\n      <script type="text/javascript" [src]="script"><\/script>\n    </div>\n    <form class="json-schema-form" (ngSubmit)="submitForm()">\n      <root-widget [layout]="jsf?.layout"></root-widget>\n    </form>\n    <div *ngIf="debug || jsf?.formOptions?.debug">\n      Debug output:\n      <pre>{{ debugOutput }}</pre>\n    </div>\n  ',changeDetection:e.ChangeDetectionStrategy.OnPush,providers:[r.JsonSchemaFormService,l]}),m("design:paramtypes",[e.ChangeDetectorRef,r.FrameworkLibraryService,r.WidgetLibraryService,r.JsonSchemaFormService,i.DomSanitizer])],t)}(),y=this&&this.__decorate||function(t,e,s,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,s,i);else for(var n=t.length-1;n>=0;n--)(o=t[n])&&(a=(r<3?o(a):r>3?o(e,s,a):o(e,s))||a);return r>3&&a&&Object.defineProperty(e,s,a),a},j=this&&this.__read||function(t,e){var s="function"==typeof Symbol&&t[Symbol.iterator];if(!s)return t;var i,o,r=s.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(s=r.return)&&s.call(r)}finally{if(o)throw o.error}}return a},g=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(j(arguments[e]));return t},b=function(){function t(){}var i;return i=t,t.forRoot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var s=t.length?t.map((function(t){return t.forRoot().providers[0]})):[{provide:a.Framework,useClass:h.NoFramework,multi:!0}];return{ngModule:i,providers:g([r.JsonSchemaFormService,r.FrameworkLibraryService,r.WidgetLibraryService],s)}},t=i=y([e.NgModule({imports:[n.CommonModule,s.FormsModule,s.ReactiveFormsModule,r.WidgetLibraryModule],declarations:[d],exports:[d,r.WidgetLibraryModule]})],t)}();t.JSON_SCHEMA_FORM_VALUE_ACCESSOR=l,t.JsonSchemaFormComponent=d,t.JsonSchemaFormModule=b,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngsf-json-schema-form.umd.min.js.map